<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>HUYMANH</title>
<style>
body{
  margin:0;
  background:#050b1a;
  color:#00f6ff;
  font-family:monospace;
  overflow:hidden;
}
h1{text-align:center;letter-spacing:4px}
.board{display:flex;justify-content:center;gap:20px;margin-top:20px}
.grid{
  display:grid;
  grid-template-rows:repeat(6,22px);
  grid-auto-columns:22px;
  gap:4px;
  padding:10px;
  background:#0b132f;
  border-radius:10px;
}
.cell{width:22px;height:22px;border-radius:4px;background:#111}
.P{background:#1e90ff}
.B{background:#ff3333}
.R{background:#ff3333}
.G{background:#1e90ff}
.controls{text-align:center;margin-top:20px}
button{
  width:60px;height:60px;border-radius:50%;
  border:none;font-size:20px;
  margin:10px;cursor:pointer
}
.p{background:#1e90ff}
.b{background:#ff3333}
.t{background:#00ff99}
#predict{
  font-size:60px;
  text-align:center;
  margin-top:20px;
  animation:spin 2s linear infinite;
}
@keyframes spin{
  0%{text-shadow:0 0 10px #0ff}
  50%{text-shadow:0 0 40px #0ff}
  100%{text-shadow:0 0 10px #0ff}
}
</style>
</head>
<body>

<h1>HUYMANH</h1>

<div class="board">
  <div>
    <h3>Big Road</h3>
    <div id="big" class="grid"></div>
  </div>
  <div>
    <h3>Big Eye</h3>
    <div id="eye" class="grid"></div>
  </div>
  <div>
    <h3>Small</h3>
    <div id="small" class="grid"></div>
  </div>
  <div>
    <h3>Cockroach</h3>
    <div id="cock" class="grid"></div>
  </div>
</div>

<div class="controls">
  <button class="p" onclick="input('P')">P</button>
  <button class="t" onclick="input('T')">T</button>
  <button class="b" onclick="input('B')">B</button>
</div>

<div id="predict">?</div>
<div style="text-align:center" id="score">Thắng:0 | Thua:0</div>

<script>
let history=[],big=[],eye=[],small=[],cock=[];
let win=0,lose=0,lastPredict=null;

function input(x){
 if(x==='T')return;
 history.push(x);
 buildBig();
 buildSide();
 predict();
 render();
 if(lastPredict){
   if(lastPredict===x) win++; else lose++;
 }
}

function buildBig(){
 big=[];
 let col=-1,row=0,last=null;
 history.forEach(v=>{
  if(v!==last){col++;row=0}else row++;
  if(!big[col]) big[col]=[];
  big[col][row]=v;
  last=v;
 });
}

function buildSide(){
 eye=calcSide(1);
 small=calcSide(2);
 cock=calcSide(3);
}

function calcSide(offset){
 let arr=[];
 for(let i=offset;i<big.length;i++){
  let a=big[i]?.length||0;
  let b=big[i-offset]?.length||0;
  arr.push(a===b?'R':'G');
 }
 return arr;
}

function predict(){
 let r=[eye,small,cock].map(x=>x.at(-1)).filter(Boolean);
 let score=r.filter(x=>x==='R').length;
 lastPredict= score>=2 ? history.at(-1) : (history.at(-1)==='P'?'B':'P');
 document.getElementById('predict').innerText=lastPredict;
 document.getElementById('score').innerText=`Thắng:${win} | Thua:${lose}`;
}

function render(){
 draw(big,'big','P','B');
 drawLine(eye,'eye');
 drawLine(small,'small');
 drawLine(cock,'cock');
}

function draw(data,id,p,b){
 let g=document.getElementById(id);g.innerHTML='';
 data.forEach(c=>c.forEach(v=>{
  let d=document.createElement('div');
  d.className='cell '+v;
  g.appendChild(d);
 }));
}

function drawLine(arr,id){
 let g=document.getElementById(id);g.innerHTML='';
 arr.forEach(v=>{
  let d=document.createElement('div');
  d.className='cell '+v;
  g.appendChild(d);
 });
}
</script>

</body>
</html>
